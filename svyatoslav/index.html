<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Личный кабинет</title>

    <link href="../Assets/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../Assets/swiper-bundle.min.css" />
    <link href="../Assets/style.css" rel="stylesheet" />
    <script src="../Assets/bootstrap.bundle.min.js"></script>
    <script src="../Assets/script_banner.js"></script>
    <link rel="icon" href="../Media/favicon.svg" type="image/x-icon" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../Media/apple-icon.png"
    />

    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../Media/android-favicon.png"
    />

    <meta property="og:title" content="Личный кабинет" />
    <meta
      property="og:description"
      content="Информация о занятиях, pdf файлы и важные новости в одном месте."
    />
    <meta property="og:url" content="https://vitaliyisitov.me/lk/svytoslav" />
    <meta property="og:image" content="../Media/Preview.png" />
  </head>
  <body>
    <div id="preloader">
      <span class="loader"></span>
    </div>
    <div class="container mt-4">
      <div class="info">
        <h1 class="mb-4 myflex-title">
          <img class="round-avatar" src="../Media/avatar.svg" alt="Avatar" />
          ПРИВЕТ, СВЯТОСЛАВ
        </h1>
      </div>
      <div class="info">
        <h5 class="mt-1 myflex-text">
          Добро пожаловать в личный кабинет! Тут ты сможешь увидеть важные
          новости и просмотреть статистику по месяцам, а также скачать записи с
          занятий в формате pdf
        </h5>
      </div>
      <div class="info">
        <h5 class="mt-4 myflex">/новости</h5>
      </div>
      <!-- <img
        class="img-fluid mx-auto d-block"
        id="carouselExampleSlidesOnly"
        src="../Media/Group 13.svg"
        alt="Avatar"
      /> -->
      <div id="carouselExampleSlidesOnly">
        <!-- Swiper -->
        <div class="swiper mySwiper">
          <div class="swiper-wrapper"></div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
      <div class="info">
        <h5 class="mt-4 myflex">/отчётность</h5>
      </div>

      <button
        id="backBtn"
        class="btn btn-outline-light d-none mb-4 d-flex align-items-center"
        onclick="showMonths()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="25"
          height="25"
          fill="currentColor"
          class="bi bi-arrow-left"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"
          />
        </svg>
      </button>
      <div id="studentData" class="row"></div>
      <div class="info">
        <h5 class="mb-5 mt-5 myflex-text-footer">
          <span style="color: white"
            >ВИТАЛИЙ ИСИТОВ
            <span style="color: rgba(248, 248, 248, 0.3)"
              >- репетитор по математике и информатике</span
            ></span
          >
          <!-- <a
            style="
              text-decoration: none;
              display: inline-block;
              vertical-align: baseline;
            "
            href="https://t.me/isitovv"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-telegram"
              viewBox="0 0 16 16"
              style="vertical-align: baseline"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.287 5.906q-1.168.486-4.666 2.01-.567.225-.595.442c-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294q.39.01.868-.32 3.269-2.206 3.374-2.23c.05-.012.12-.026.166.016s.042.12.037.141c-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8 8 0 0 1-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629q.14.092.27.187c.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.4 1.4 0 0 0-.013-.315.34.34 0 0 0-.114-.217.53.53 0 0 0-.31-.093c-.3.005-.763.166-2.984 1.09"
              />
            </svg>
            isitovv
          </a> -->
        </h5>
      </div>
    </div>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Initialize Swiper -->
    <script>
      // script.js
      window.addEventListener("load", function () {
        var preloader = document.getElementById("preloader");
        preloader.style.display = "none";
      });
      var swiper = new Swiper(".mySwiper", {
        spaceBetween: 30,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
      });
    </script>
    <script>
      // Главная страница
      var currentMode = "months"; // Режим по умолчанию: месяцы
      var currentMonthData; // Данные для текущего месяца
      var sortedData; // Отсортированные данные по месяцам

      // Функция для чтения CSV файла
      function readCSV(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            callback(xhr.responseText);
          }
        };
        xhr.open("GET", url, true);
        xhr.send();
      }

      // Функция для фильтрации данных по имени ученика
      function filterData(data, name) {
        var filteredData = data.filter(function (row) {
          return row[0] === name; // Предполагается, что имя ученика находится в первом столбце
        });
        return filteredData;
      }

      // Функция для сортировки данных по месяцам
      function sortDataByMonth(data) {
        var sortedData = {};
        var monthsOrder = [
          "09",
          "10",
          "11",
          "12",
          "01",
          "02",
          "03",
          "04",
          "05",
        ];
        // Порядок месяцев
        var monthIndexes = {
          "05": 0,
          "04": 1,
          "03": 2,
          "02": 3,
          "01": 4,
          12: 5,
          11: 6,
          10: 7,
          "09": 8,
        };

        data.forEach(function (row) {
          var dateParts = row[1].split("/"); // Разбиваем дату по разделителю "/"
          var dayMonthYear = dateParts[0].split(".").reverse().join("/"); // Преобразуем дату в формат "гггг/мм/дд"
          var month = dayMonthYear.split("/")[1]; // Получаем номер месяца из даты
          if (monthsOrder.includes(month)) {
            if (!sortedData[month]) {
              sortedData[month] = [];
            }
            sortedData[month].push(row);
          }
        });

        var sortedMonths = Object.keys(sortedData).sort(compareMonths); // Сортируем месяцы

        var result = {};
        sortedMonths.forEach(function (month) {
          result[month] = sortedData[month];
        });

        return result;
      }

      // Функция для сравнения месяцев
      function compareMonths(a, b) {
        const indexA = getMonthIndex(a);
        const indexB = getMonthIndex(b);
        return indexB - indexA;
      }

      // Функция для получения индекса месяца в новом порядке
      function getMonthIndex(month) {
        var monthIndexes = {
          "09": 0,
          10: 1,
          11: 2,
          12: 3,
          "01": 4,
          "02": 5,
          "03": 6,
          "04": 7,
          "05": 8,
        };
        return monthIndexes[month];
      }

      function displayMonths(data) {
        var studentDataDiv = document.getElementById("studentData");
        var html = "";

        var sortedMonths = Object.keys(data).sort(compareMonths); // Сортируем месяцы

        // Создаем объект с ссылками на фотографии для каждого месяца
        var monthImages = {
          "09": "../Media/sep.png",
          10: "../Media/oct.png",
          11: "../Media/nov.png",
          12: "../Media/dec.png",
          "01": "../Media/jan.png",
          "02": "../Media/feb.png",
          "03": "../Media/mart.png",
          "04": "../Media/apr.png",
          "05": "../Media/may.png",
        };

        // В цикле используем этот объект для отображения фотографии для каждого месяца
        sortedMonths.forEach(function (month) {
          html +=
            "<div class='col-4 col-lg-3 mb-4' onclick='showLessons(" +
            JSON.stringify(data[month]) +
            ")'>";
          html += "<div class='card text-white'>";
          html +=
            "<img src='" + monthImages[month] + "' class='card-img' alt=''>";
          html += "<div class='card-img-overlay'>";
          // html += "<h5 class='card-title'>" + getMonthName(month) + "</h5>";
          html += "</div>";
          html += "</div>";
          html += "</div>";
        });

        studentDataDiv.innerHTML = html;
      }

      // Функция для отображения данных о занятиях по выбранному месяцу
      function displayLessons(data) {
        currentMonthData = data; // Сохраняем данные текущего месяца
        var studentDataDiv = document.getElementById("studentData");
        var backButton = document.getElementById("backBtn");
        var html = "";

        data.forEach(function (row) {
          html += "<div class='col-lg-4 mb-4'>";
          html += "<div class='card mycard'>";
          html += "<div class='card-body d-flex flex-column'>"; // Используем flexbox

          html += "<h5 class='card-title'>" + row[2] + "</h5>"; // Предмет
          html +=
            "<p class='card-subtitle mb-2 text-body-secondary'>" +
            row[1] +
            "</p>"; // Дата
          html += "<p class='card-text'>" + row[3] + "</p>"; // Комментарий

          html += "<div class='mt-auto'>"; // Контейнер для кнопки
          // Проверяем наличие ссылки на скачивание
          if (row[4]) {
            // Если ссылка есть, создаем кнопку с иконкой
            html +=
              "<a href='" +
              row[5] +
              "' class='btn btn-outline-primary' download style='display: flex; align-items: center; justify-content: center;'>" +
              "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-filetype-pdf' viewBox='0 0 16 16' style='margin-right: 5px;'>" +
              "<path fill-rule='evenodd' d='M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z'/>" +
              "</svg>" +
              "Скачать" +
              "</a>"; // Скачивание файла pdf
          } else {
            // Если ссылки нет, просто добавляем текст без кнопки
            html += "<span class='card-link'>" + row[4] + "</span>";
          }
          html += "</div>"; // Конец контейнера для кнопки

          html += "</div>";
          html += "</div>";
          html += "</div>";
        });

        backButton.classList.remove("d-none"); // Показываем кнопку "назад"
        var infoElements = document.querySelectorAll(".info");
        infoElements.forEach(function (infoElement) {
          infoElement.classList.add("d-none"); // Скрываем элементы с классом "info"
        });
        var carouselExampleSlidesOnly = document.getElementById(
          "carouselExampleSlidesOnly"
        );
        carouselExampleSlidesOnly.classList.add("d-none"); // добавляем баннер
        studentDataDiv.innerHTML = html;
        // Прокручиваем карточки с занятиями к верху контейнера studentData
        backButton.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      // Функция для отображения данных на странице
      function showMonths() {
        currentMode = "months";
        var backButton = document.getElementById("backBtn");
        carouselExampleSlidesOnly.classList.remove("d-none"); // добавляем баннер
        backButton.classList.add("d-none"); // Скрываем кнопку "назад"
        var infoElements = document.querySelectorAll(".info");
        infoElements.forEach(function (infoElement) {
          infoElement.classList.remove("d-none"); // Отображаем элементы с классом "info"
        });
        displayMonths(sortedData); // Отображаем карточки с месяцами
      }

      // Функция для отображения данных на странице
      function showLessons(data) {
        currentMode = "lessons";
        displayLessons(data); // Отображаем данные о занятиях по выбранному месяцу
      }

      // Функция для получения названия месяца по его номеру
      function getMonthName(month) {
        var months = {
          "01": "Январь",
          "02": "Февраль",
          "03": "Март",
          "04": "Апрель",
          "05": "Май",
          "06": "Июнь",
          "07": "Июль",
          "08": "Август",
          "09": "Сентябрь",
          10: "Октябрь",
          11: "Ноябрь",
          12: "Декабрь",
        };
        return months[month];
      }

      // Загрузка данных из CSV файла и отображение на странице

      // Функция для чтения CSV файла
      function readCSV(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            callback(xhr.responseText);
          }
        };
        xhr.open("GET", url, true);
        xhr.send();
      }

      // Функция для чтения CSV файла с учетом кавычек
      function parseCSV(csvData) {
        var lines = csvData.trim().split("\n");
        var rows = [];

        lines.forEach(function (line) {
          var row = [];
          var insideQuote = false;
          var currentField = "";

          for (var i = 0; i < line.length; i++) {
            var char = line[i];

            if (char === "," && !insideQuote) {
              row.push(currentField.trim());
              currentField = "";
            } else if (char === '"') {
              insideQuote = !insideQuote;
            } else {
              currentField += char;
            }
          }

          row.push(currentField.trim());
          rows.push(row);
        });

        return rows;
      }

      // Загрузка данных из CSV файла и отображение на странице
      readCSV("../updated_data.csv", function (csvData) {
        var rows = parseCSV(csvData);
        var filteredData = filterData(rows, "Святослав");
        sortedData = sortDataByMonth(filteredData);
        displayMonths(sortedData); // Отображаем карточки с месяцами при загрузке страницы
      });
    </script>
  </body>
</html>
