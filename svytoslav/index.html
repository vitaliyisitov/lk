<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Личный кабинет</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <!-- Обычный фавикон -->
    <link rel="icon" href="../Media/favicon.svg" type="image/x-icon" />
    <!-- Фавикон для устройств Apple -->
    <link rel="apple-touch-icon" sizes="180x180" href="../Media/favicon.svg" />
    <!-- Маска для Safari -->
    <link rel="mask-icon" href="../Media/favicon.svg" color="цвет" />
    <!-- Фавикон для Android -->
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../Media/favicon.svg"
    />
    <!-- Фавикон для Windows -->
    <meta name="msapplication-TileImage" content="../Media/favicon.svg" />
    <meta property="og:title" content="Личный кабинет" />
    <meta
      property="og:description"
      content="Информация о занятиях, pdf файлы и важные новости в одном месте."
    />
    <meta property="og:url" content="https://vitaliyisitov.me/lk/svytoslav" />
    <meta property="og:image" content="../Media/Preview.png" />
    <style>
      body {
        background-color: #fffffff7;
      }
      .card .card-img {
        height: 100%;
        object-fit: cover;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.3s ease;
        height: 200px;
        overflow: hidden;
        border-radius: 15px;
      }

      .mycard {
        height: 100%;
      }

      .card:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .card-header {
        background-color: #007bff;
        color: #fff;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        padding: 10px;
      }

      .card-body {
        padding: 20px;
      }
      .round-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        border: 1px solid #007bff;
      }
      .myflex {
        display: flex;
        align-items: center;
        background-color: antiquewhite;
        border-radius: 15px;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <div class="info">
        <h3 class="mb-4 myflex">
          <img class="round-avatar" src="../Media/Frame 35.svg" alt="Avatar" />
          Святослав, <span id="greeting"> </span>
        </h3>
      </div>
      <img
        class="img-fluid mx-auto d-block"
        id="carouselExampleSlidesOnly"
        src="../Media/Group 13.svg"
        alt="Avatar"
      />
      <div class="info">
        <h5 class="mb-4 myflex">
          <img class="round-avatar" src="../Media/Frame 36.svg" alt="Avatar" />
          Отчётность
        </h5>
      </div>
      <button
        id="backBtn"
        class="btn btn-outline-dark d-none mb-4 d-flex align-items-center"
        onclick="showMonths()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="25"
          height="25"
          fill="currentColor"
          class="bi bi-arrow-left"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"
          />
        </svg>
      </button>
      <div id="studentData" class="row"></div>
    </div>

    <script>
      // Печатание слова привет на разных языках
      var greetings = [
        "привет",
        "bonjour",
        "hola",
        "ciao",
        "你好",
        "hello",
        "どうも",
      ];

      var typingInterval = 150;

      // Функция для печати текста с эффектом машинного печатающего устройства
      function printTextWithEffect(text, element) {
        var index = 0;
        var intervalId = setInterval(function () {
          if (index < text.length) {
            element.innerHTML += text.charAt(index);
            index++;
          } else {
            clearInterval(intervalId);
            setTimeout(function () {
              eraseTextWithEffect(element);
            }, typingInterval);
          }
        }, typingInterval);
      }

      // Функция для стирания текста с эффектом
      function eraseTextWithEffect(element) {
        var text = element.innerHTML;
        var index = text.length - 1;
        var intervalId = setInterval(function () {
          if (index >= 0) {
            element.innerHTML = text.substring(0, index);
            index--;
          } else {
            clearInterval(intervalId);
            // Выбор нового приветствия после стирания
            var randomIndex = Math.floor(Math.random() * greetings.length);
            var greeting = greetings[randomIndex];
            // Задержка перед печатью нового приветствия
            setTimeout(function () {
              printTextWithEffect(greeting, element);
            }, typingInterval);
          }
        }, typingInterval);
      }

      // Найти элемент, в который нужно напечатать приветствие
      var greetingElement = document.getElementById("greeting");

      // Начать процесс с печати первого приветствия
      var initialGreetingIndex = Math.floor(Math.random() * greetings.length);
      printTextWithEffect(greetings[initialGreetingIndex], greetingElement);

      // Главная страница
      var currentMode = "months"; // Режим по умолчанию: месяцы
      var currentMonthData; // Данные для текущего месяца
      var sortedData; // Отсортированные данные по месяцам

      // Функция для чтения CSV файла
      function readCSV(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            callback(xhr.responseText);
          }
        };
        xhr.open("GET", url, true);
        xhr.send();
      }

      // Функция для фильтрации данных по имени ученика
      function filterData(data, name) {
        var filteredData = data.filter(function (row) {
          return row[0] === name; // Предполагается, что имя ученика находится в первом столбце
        });
        return filteredData;
      }

      // Функция для сортировки данных по месяцам
      function sortDataByMonth(data) {
        var sortedData = {};
        var monthsOrder = [
          "09",
          "10",
          "11",
          "12",
          "01",
          "02",
          "03",
          "04",
          "05",
        ];
        // Порядок месяцев
        var monthIndexes = {
          "09": 0,
          10: 1,
          11: 2,
          12: 3,
          "01": 4,
          "02": 5,
          "03": 6,
          "04": 7,
          "05": 8,
        };

        data.forEach(function (row) {
          var dateParts = row[1].split("/"); // Разбиваем дату по разделителю "/"
          var dayMonthYear = dateParts[0].split(".").reverse().join("/"); // Преобразуем дату в формат "гггг/мм/дд"
          var month = dayMonthYear.split("/")[1]; // Получаем номер месяца из даты
          if (monthsOrder.includes(month)) {
            if (!sortedData[month]) {
              sortedData[month] = [];
            }
            sortedData[month].push(row);
          }
        });

        var sortedMonths = Object.keys(sortedData).sort(compareMonths); // Сортируем месяцы

        var result = {};
        sortedMonths.forEach(function (month) {
          result[month] = sortedData[month];
        });

        return result;
      }

      // Функция для сравнения месяцев
      function compareMonths(a, b) {
        const indexA = getMonthIndex(a);
        const indexB = getMonthIndex(b);
        return indexA - indexB;
      }

      // Функция для получения индекса месяца в новом порядке
      function getMonthIndex(month) {
        var monthIndexes = {
          "09": 0,
          10: 1,
          11: 2,
          12: 3,
          "01": 4,
          "02": 5,
          "03": 6,
          "04": 7,
          "05": 8,
        };
        return monthIndexes[month];
      }

      function displayMonths(data) {
        var studentDataDiv = document.getElementById("studentData");
        var html = "";

        var sortedMonths = Object.keys(data).sort(compareMonths); // Сортируем месяцы

        // Создаем объект с ссылками на фотографии для каждого месяца
        var monthImages = {
          "09": "../Media/3840bac02bba19ca9bdb72d91ae75ddc.gif",
          10: "../Media/bg_80.gif",
          11: "../Media/bg_87.gif",
          12: "../Media/bg_73.gif",
          "01": "../Media/image_processing20210730-13842-od4q27.gif",
          "02": "../Media/bg_74.gif",
          "03": "../Media/bg_77.gif",
          "04": "../Media/bg_79.gif",
          "05": "../Media/CWN.gif",
        };

        // В цикле используем этот объект для отображения фотографии для каждого месяца
        sortedMonths.forEach(function (month) {
          html +=
            "<div class='col-lg-4 mb-4' onclick='showLessons(" +
            JSON.stringify(data[month]) +
            ")'>";
          html += "<div class='card bg-dark text-white'>";
          html +=
            "<img src='" + monthImages[month] + "' class='card-img' alt=''>";
          html += "<div class='card-img-overlay'>";
          html += "<h5 class='card-title'>" + getMonthName(month) + "</h5>";
          html += "</div>";
          html += "</div>";
          html += "</div>";
        });

        studentDataDiv.innerHTML = html;
      }

      // Функция для отображения данных о занятиях по выбранному месяцу
      function displayLessons(data) {
        currentMonthData = data; // Сохраняем данные текущего месяца
        var studentDataDiv = document.getElementById("studentData");
        var html = "";

        data.forEach(function (row) {
          html += "<div class='col-lg-4 mb-4'>";
          html += "<div class='card mycard'>";
          html += "<div class='card-body'>";
          html += "<h5 class='card-title'>" + row[2] + "</h5>"; // Предмет
          html +=
            "<p class='card-subtitle mb-2 text-body-secondary'>" +
            row[1] +
            "</p>"; // Дата
          html += "<p class='card-text'>" + row[3] + "</p>"; // Комментарий

          // Проверяем наличие ссылки на скачивание
          if (row[4]) {
            // Если ссылка есть, создаем кнопку с иконкой
            html +=
              "<a href='" +
              row[5] +
              "' class='btn btn-outline-primary' download style='display: flex; align-items: center; justify-content: center;'>" +
              "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-filetype-pdf' viewBox='0 0 16 16' style='margin-right: 5px;'>" +
              "<path fill-rule='evenodd' d='M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z'/>" +
              "</svg>" +
              "Скачать" +
              "</a>"; // Скачивание файла pdf
          } else {
            // Если ссылки нет, просто добавляем текст без кнопки
            html += "<span class='card-link'>" + row[4] + "</span>";
          }

          html += "</div>";
          html += "</div>";
          html += "</div>";
        });

        var backButton = document.getElementById("backBtn");
        backButton.classList.remove("d-none"); // Показываем кнопку "назад"
        var infoElements = document.querySelectorAll(".info");
        infoElements.forEach(function (infoElement) {
          infoElement.classList.add("d-none"); // Скрываем элементы с классом "info"
        });
        var carouselExampleSlidesOnly = document.getElementById(
          "carouselExampleSlidesOnly"
        );
        carouselExampleSlidesOnly.classList.add("d-none"); // добавляем баннер
        studentDataDiv.innerHTML = html;
      }

      // Функция для отображения данных на странице
      function showMonths() {
        currentMode = "months";
        var backButton = document.getElementById("backBtn");
        carouselExampleSlidesOnly.classList.remove("d-none"); // добавляем баннер
        backButton.classList.add("d-none"); // Скрываем кнопку "назад"
        var infoElements = document.querySelectorAll(".info");
        infoElements.forEach(function (infoElement) {
          infoElement.classList.remove("d-none"); // Отображаем элементы с классом "info"
        });
        displayMonths(sortedData); // Отображаем карточки с месяцами
      }

      // Функция для отображения данных на странице
      function showLessons(data) {
        currentMode = "lessons";
        displayLessons(data); // Отображаем данные о занятиях по выбранному месяцу
      }

      // Функция для получения названия месяца по его номеру
      function getMonthName(month) {
        var months = {
          "01": "Январь",
          "02": "Февраль",
          "03": "Март",
          "04": "Апрель",
          "05": "Май",
          "06": "Июнь",
          "07": "Июль",
          "08": "Август",
          "09": "Сентябрь",
          10: "Октябрь",
          11: "Ноябрь",
          12: "Декабрь",
        };
        return months[month];
      }

      // Загрузка данных из CSV файла и отображение на странице

      // Функция для чтения CSV файла
      function readCSV(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            callback(xhr.responseText);
          }
        };
        xhr.open("GET", url, true);
        xhr.send();
      }

      // Функция для чтения CSV файла с учетом кавычек
      function parseCSV(csvData) {
        var lines = csvData.trim().split("\n");
        var rows = [];

        lines.forEach(function (line) {
          var row = [];
          var insideQuote = false;
          var currentField = "";

          for (var i = 0; i < line.length; i++) {
            var char = line[i];

            if (char === "," && !insideQuote) {
              row.push(currentField.trim());
              currentField = "";
            } else if (char === '"') {
              insideQuote = !insideQuote;
            } else {
              currentField += char;
            }
          }

          row.push(currentField.trim());
          rows.push(row);
        });

        return rows;
      }

      // Загрузка данных из CSV файла и отображение на странице
      readCSV("../updated_data.csv", function (csvData) {
        var rows = parseCSV(csvData);
        var filteredData = filterData(rows, "Святослав");
        sortedData = sortDataByMonth(filteredData);
        displayMonths(sortedData); // Отображаем карточки с месяцами при загрузке страницы
      });
    </script>
  </body>
</html>
